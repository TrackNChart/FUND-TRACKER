<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expense & Budget Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      min-height: 100vh;
      font-family: Inter, sans-serif;
      background: url('/mnt/data/095c633f-26a8-4b4e-a3b4-bc128ac428de.png') center/cover fixed no-repeat;
    }
    .overlay {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    #logout-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      background: #dc2626;
      color: white;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
    }
    #logout-btn:hover {
      background: #b91c1c;
    }
  </style>
</head>
<body class="flex items-center justify-center p-6">

  <!-- Auth Section -->
  <div id="auth-section" class="overlay w-full max-w-sm">
    <h2 id="auth-title" class="text-2xl font-bold mb-4">Log In</h2>
    <input id="username" type="text" placeholder="Username" class="border p-2 w-full rounded mb-3">
    <input id="password" type="password" placeholder="Password" class="border p-2 w-full rounded mb-3">
    <button id="auth-btn" class="bg-blue-500 text-white px-4 py-2 rounded w-full hover:bg-blue-600">Log In</button>
    <p class="mt-3 text-sm text-center">
      Don’t have an account? 
      <a id="toggle-auth" href="#" class="text-blue-600 hover:underline">Sign Up</a>
    </p>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden w-full max-w-6xl grid grid-cols-1 md:grid-cols-3 gap-6 relative">
    <button id="logout-btn">Log Out</button>

    <!-- Budget Panel -->
    <div class="overlay">
      <h2 class="text-xl font-semibold mb-3">Set Budget</h2>
      <input type="number" id="budget-input" placeholder="Enter budget" class="border p-2 w-full rounded mb-3">
      <button id="set-budget" class="bg-green-500 text-white px-4 py-2 rounded w-full hover:bg-green-600">Save Budget</button>
      <p id="budget-display" class="mt-3 font-bold text-lg">Budget: ₱0.00</p>
    </div>

    <!-- Expense Panel -->
    <div class="overlay">
      <h2 class="text-xl font-semibold mb-3">Add Expense</h2>
      <input type="text" id="expense-name" placeholder="Expense name" class="border p-2 w-full rounded mb-2">
      <input type="number" id="expense-amount" placeholder="Amount" class="border p-2 w-full rounded mb-2">
      <select id="expense-category" class="border p-2 w-full rounded mb-3">
        <option>Food</option>
        <option>Transport</option>
        <option>Bills</option>
        <option>Shopping</option>
        <option>Other</option>
      </select>
      <button id="add-expense" class="bg-blue-500 text-white px-4 py-2 rounded w-full hover:bg-blue-600">Add</button>
      <ul id="expense-list" class="mt-3 space-y-2 max-h-40 overflow-y-auto"></ul>
    </div>

    <!-- Summary Panel -->
    <div class="overlay">
      <h2 class="text-xl font-semibold mb-4">Summary</h2>
      <p id="total-expenses" class="text-lg">Total Expenses: ₱0.00</p>
      <p id="remaining-budget" class="text-lg font-semibold">Remaining Budget: ₱0.00</p>
      <hr class="my-2">
      <p id="monthly-total" class="text-md">Monthly Expenses: ₱0.00</p>
      <p id="annual-total" class="text-md">Annual Expenses: ₱0.00</p>
      <button id="reset-btn" class="mt-4 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 w-full">Reset Tracker</button>
    </div>

    <!-- Charts -->
    <div class="overlay md:col-span-2">
      <h2 class="text-xl font-semibold mb-3">Expense Breakdown</h2>
      <canvas id="expenseChart"></canvas>
    </div>
    <div class="overlay">
      <h2 class="text-xl font-semibold mb-3">Monthly Expenses</h2>
      <canvas id="monthlyChart"></canvas>
    </div>
  </div>

  <script>
    // DOM Elements
    const authSection = document.getElementById("auth-section");
    const dashboard = document.getElementById("dashboard");
    const authBtn = document.getElementById("auth-btn");
    const toggleAuth = document.getElementById("toggle-auth");
    const authTitle = document.getElementById("auth-title");
    const logoutBtn = document.getElementById("logout-btn");

    let isLogin = true;
    let currentUser = null;
    let budget = 0;
    let expenses = [];
    let categories = { Food:0, Transport:0, Bills:0, Shopping:0, Other:0 };

    // Charts
    const expenseChart = new Chart(document.getElementById("expenseChart"), {
      type: "pie",
      data: {
        labels: Object.keys(categories),
        datasets: [{ data: Object.values(categories), backgroundColor: ["#3b82f6","#10b981","#f59e0b","#ef4444","#6366f1"] }]
      }
    });
    const monthlyChart = new Chart(document.getElementById("monthlyChart"), {
      type: "bar",
      data: {
        labels: ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
        datasets: [{ label:"Expenses", data:Array(12).fill(0), backgroundColor:"#3b82f6" }]
      }
    });

    // Toggle Login/Signup
    toggleAuth.addEventListener("click", (e) => {
      e.preventDefault();
      isLogin = !isLogin;
      authTitle.textContent = isLogin ? "Log In" : "Sign Up";
      authBtn.textContent = isLogin ? "Log In" : "Sign Up";
      toggleAuth.textContent = isLogin ? "Sign Up" : "Log In";
    });

    // Auth
    authBtn.addEventListener("click", () => {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      if (!username || !password) return alert("Please fill in all fields.");

      let users = JSON.parse(localStorage.getItem("users")) || {};
      if (isLogin) {
        if (users[username] && users[username].password === password) {
          currentUser = username;
          loadUserData();
          authSection.classList.add("hidden");
          dashboard.classList.remove("hidden");
        } else {
          alert("Invalid username or password.");
        }
      } else {
        if (users[username]) return alert("User already exists.");
        users[username] = { password, data:{budget:0,expenses:[],categories:{Food:0,Transport:0,Bills:0,Shopping:0,Other:0}} };
        localStorage.setItem("users", JSON.stringify(users));
        alert("Account created! Please log in.");
        isLogin = true;
        authTitle.textContent = "Log In";
        authBtn.textContent = "Log In";
        toggleAuth.textContent = "Sign Up";
      }
    });

    logoutBtn.addEventListener("click", () => {
      currentUser = null;
      dashboard.classList.add("hidden");
      authSection.classList.remove("hidden");
    });

    // Tracker Functions
    const budgetInput = document.getElementById("budget-input");
    const setBudgetBtn = document.getElementById("set-budget");
    const budgetDisplay = document.getElementById("budget-display");
    const expenseName = document.getElementById("expense-name");
    const expenseAmount = document.getElementById("expense-amount");
    const expenseCategory = document.getElementById("expense-category");
    const addExpenseBtn = document.getElementById("add-expense");
    const expenseList = document.getElementById("expense-list");
    const totalExpenses = document.getElementById("total-expenses");
    const remainingBudget = document.getElementById("remaining-budget");
    const monthlyTotal = document.getElementById("monthly-total");
    const annualTotal = document.getElementById("annual-total");

    function saveUserData() {
      let users = JSON.parse(localStorage.getItem("users")) || {};
      if (currentUser) {
        users[currentUser].data = { budget, expenses, categories };
        localStorage.setItem("users", JSON.stringify(users));
      }
    }

    function loadUserData() {
      let users = JSON.parse(localStorage.getItem("users")) || {};
      if (users[currentUser]) {
        budget = users[currentUser].data.budget;
        expenses = users[currentUser].data.expenses;
        categories = users[currentUser].data.categories || categories;
        budgetDisplay.textContent = `Budget: ₱${budget.toFixed(2)}`;
        renderExpenses();
        updateSummary();
      }
    }

    setBudgetBtn.addEventListener("click", () => {
      budget = parseFloat(budgetInput.value) || 0;
      budgetDisplay.textContent = `Budget: ₱${budget.toFixed(2)}`;
      saveUserData();
      updateSummary();
    });

    addExpenseBtn.addEventListener("click", () => {
      const name = expenseName.value.trim();
      const amount = parseFloat(expenseAmount.value);
      const category = expenseCategory.value;
      if (!name || isNaN(amount) || amount <= 0) return;

      const date = new Date();
      expenses.push({ name, amount, category, date: date.toISOString() });
      categories[category] += amount;

      expenseName.value = "";
      expenseAmount.value = "";

      saveUserData();
      renderExpenses();
      updateSummary();
    });

    function renderExpenses() {
      expenseList.innerHTML = "";
      expenses.forEach((e) => {
        let li = document.createElement("li");
        li.textContent = `${e.name} - ₱${e.amount.toFixed(2)} (${e.category})`;
        expenseList.appendChild(li);
      });
    }

    function updateSummary() {
      let total = expenses.reduce((sum,e)=>sum+e.amount,0);
      totalExpenses.textContent = `Total Expenses: ₱${total.toFixed(2)}`;
      remainingBudget.textContent = `Remaining Budget: ₱${(budget-total).toFixed(2)}`;

      // Monthly + Annual
      let now = new Date();
      let monthTotal = expenses.filter(e=>new Date(e.date).getMonth()===now.getMonth() && new Date(e.date).getFullYear()===now.getFullYear()).reduce((sum,e)=>sum+e.amount,0);
      let yearTotal = expenses.filter(e=>new Date(e.date).getFullYear()===now.getFullYear()).reduce((sum,e)=>sum+e.amount,0);

      monthlyTotal.textContent = `Monthly Expenses: ₱${monthTotal.toFixed(2)}`;
      annualTotal.textContent = `Annual Expenses: ₱${yearTotal.toFixed(2)}`;

      // Update charts
      expenseChart.data.datasets[0].data = Object.values(categories);
      expenseChart.update();

      let monthlyData = Array(12).fill(0);
      expenses.forEach(e => {
        let d = new Date(e.date);
        if (d.getFullYear()===now.getFullYear()) {
          monthlyData[d.getMonth()] += e.amount;
        }
      });
      monthlyChart.data.datasets[0].data = monthlyData;
      monthlyChart.update();
    }

    // Reset
    document.getElementById("reset-btn").addEventListener("click", () => {
      if (!confirm("Are you sure you want to reset your tracker?")) return;
      budget = 0;
      expenses = [];
      categories = { Food:0, Transport:0, Bills:0, Shopping:0, Other:0 };
      saveUserData();
      budgetDisplay.textContent = "Budget: ₱0.00";
      expenseList.innerHTML = "";
      updateSummary();
    });
  </script>
</body>
</html>
