<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense & Budget Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: url('https://images.unsplash.com/photo-1554224155-8d04cb21cd6c') no-repeat center center fixed;
      background-size: cover;
    }
    header {
      position: relative;
    }
    #logout-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
    .overlay {
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body class="min-h-screen flex flex-col p-6 text-gray-800">

  <!-- Header -->
  <header class="w-full mb-6 overlay">
    <h1 class="text-2xl font-bold">üí∞ Expense & Budget Tracker</h1>
    <button id="logout-btn" class="hidden bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Logout</button>
  </header>

  <!-- Auth Section -->
  <div id="auth-section" class="overlay w-full max-w-md mx-auto">
    <h2 class="text-xl font-semibold mb-4">Login or Register</h2>
    <form id="register-form" class="space-y-2 mb-4">
      <input type="text" id="reg-username" placeholder="Username" required class="w-full p-2 border rounded-lg">
      <input type="password" id="reg-password" placeholder="Password" required class="w-full p-2 border rounded-lg">
      <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded-lg w-full hover:bg-green-600">Register</button>
    </form>
    <form id="login-form" class="space-y-2">
      <input type="text" id="login-username" placeholder="Username" required class="w-full p-2 border rounded-lg">
      <input type="password" id="login-password" placeholder="Password" required class="w-full p-2 border rounded-lg">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg w-full hover:bg-blue-600">Login</button>
    </form>
    <p id="auth-message" class="mt-2 text-red-500 text-sm"></p>
  </div>

  <!-- Tracker Section -->
  <div id="tracker-section" class="hidden grid grid-cols-1 md:grid-cols-2 gap-6 w-full">

    <!-- Left Side: Budget + Summary -->
    <div class="space-y-6">
      <!-- Budget -->
      <div class="overlay">
        <h2 class="text-xl font-semibold mb-4">Set Budget</h2>
        <form id="budget-form" class="space-y-4">
          <input type="number" id="budget-amount" placeholder="Enter budget (‚Ç±)" required class="w-full p-2 border rounded-lg">
          <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded-lg w-full hover:bg-green-600">Set Budget</button>
        </form>
        <p id="budget-display" class="mt-4 font-semibold text-lg">Budget: ‚Ç±0.00</p>
      </div>

      <!-- Summary -->
      <div class="overlay">
        <h2 class="text-xl font-semibold mb-4">Summary</h2>
        <p id="total-expenses" class="text-lg">Total Expenses: ‚Ç±0.00</p>
        <p id="remaining-budget" class="text-lg font-semibold">Remaining Budget: ‚Ç±0.00</p>
        <hr class="my-2">
        <p id="monthly-total" class="text-md">Monthly Expenses: ‚Ç±0.00</p>
        <p id="annual-total" class="text-md">Annual Expenses: ‚Ç±0.00</p>
        <button id="reset-btn" class="mt-4 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 w-full">
          Reset Tracker
        </button>
      </div>
    </div>

    <!-- Right Side: Expenses + Charts -->
    <div class="space-y-6">
      <!-- Add Expense -->
      <div class="overlay">
        <h2 class="text-xl font-semibold mb-4">Add Expense</h2>
        <form id="expense-form" class="space-y-4">
          <input type="text" id="expense-name" placeholder="Expense name" required class="w-full p-2 border rounded-lg">
          <input type="number" id="expense-amount" placeholder="Amount" required class="w-full p-2 border rounded-lg">
          <input type="date" id="expense-date" required class="w-full p-2 border rounded-lg">
          <select id="expense-category" required class="w-full p-2 border rounded-lg">
            <option value="Food">Food</option>
            <option value="Transport">Transport</option>
            <option value="Bills">Bills</option>
            <option value="Shopping">Shopping</option>
            <option value="Other">Other</option>
          </select>
          <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg w-full hover:bg-blue-600">Add</button>
        </form>
      </div>

      <!-- Expense List -->
      <div class="overlay max-h-60 overflow-y-auto">
        <h2 class="text-xl font-semibold mb-4">Expenses</h2>
        <ul id="expense-list" class="space-y-2"></ul>
      </div>

      <!-- Category Pie Chart -->
      <div class="overlay">
        <h2 class="text-xl font-semibold mb-4">Category Breakdown</h2>
        <canvas id="expenseChart"></canvas>
      </div>

      <!-- Monthly Bar Chart -->
      <div class="overlay">
        <h2 class="text-xl font-semibold mb-4">Monthly Expenses (This Year)</h2>
        <canvas id="monthlyChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    // ====== Authentication ======
    const authSection = document.getElementById("auth-section");
    const trackerSection = document.getElementById("tracker-section");
    const authMessage = document.getElementById("auth-message");
    const logoutBtn = document.getElementById("logout-btn");
    let currentUser = null;

    // Register
    document.getElementById("register-form").addEventListener("submit", function(e) {
      e.preventDefault();
      const username = document.getElementById("reg-username").value;
      const password = document.getElementById("reg-password").value;
      if (localStorage.getItem("user_" + username)) {
        authMessage.textContent = "Username already exists!";
        return;
      }
      localStorage.setItem("user_" + username, JSON.stringify({ password, budget: 0, expenses: [] }));
      authMessage.textContent = "‚úÖ Registration successful! You can now log in.";
    });

    // Login
    document.getElementById("login-form").addEventListener("submit", function(e) {
      e.preventDefault();
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;
      const userData = localStorage.getItem("user_" + username);
      if (!userData) { authMessage.textContent = "‚ùå User not found!"; return; }
      const user = JSON.parse(userData);
      if (user.password !== password) { authMessage.textContent = "‚ùå Incorrect password!"; return; }
      currentUser = username;
      showTracker();
    });

    // Logout
    logoutBtn.addEventListener("click", () => {
      currentUser = null;
      trackerSection.classList.add("hidden");
      authSection.classList.remove("hidden");
      logoutBtn.classList.add("hidden");
      authMessage.textContent = "You have been logged out.";
    });

    function showTracker() {
      authSection.classList.add("hidden");
      trackerSection.classList.remove("hidden");
      logoutBtn.classList.remove("hidden");
      loadUserData();
      document.getElementById("expense-date").valueAsDate = new Date(); // auto-fill date
    }

    // ====== Tracker ======
    const budgetForm = document.getElementById("budget-form");
    const budgetDisplay = document.getElementById("budget-display");
    const totalExpensesDisplay = document.getElementById("total-expenses");
    const remainingBudgetDisplay = document.getElementById("remaining-budget");
    const monthlyTotalDisplay = document.getElementById("monthly-total");
    const annualTotalDisplay = document.getElementById("annual-total");
    const expenseForm = document.getElementById("expense-form");
    const expenseList = document.getElementById("expense-list");
    const ctx = document.getElementById("expenseChart").getContext("2d");
    const monthlyCtx = document.getElementById("monthlyChart").getContext("2d");

    let budget = 0;
    let expenses = [];
    let categories = { Food: 0, Transport: 0, Bills: 0, Shopping: 0, Other: 0 };

    const expenseChart = new Chart(ctx, {
      type: "pie",
      data: { labels: Object.keys(categories), datasets: [{ data: Object.values(categories), backgroundColor: ["#f87171", "#60a5fa", "#facc15", "#34d399", "#a78bfa"] }] }
    });
    const monthlyChart = new Chart(monthlyCtx, {
      type: "bar",
      data: { labels: ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"], datasets: [{ label: "Monthly Expenses (‚Ç±)", data: Array(12).fill(0), backgroundColor: "#60a5fa" }] },
      options: { scales: { y: { beginAtZero: true } } }
    });

    function loadUserData() {
      const user = JSON.parse(localStorage.getItem("user_" + currentUser));
      budget = user.budget;
      expenses = user.expenses;
      categories = { Food: 0, Transport: 0, Bills: 0, Shopping: 0, Other: 0 };
      expenses.forEach(exp => categories[exp.category] += exp.amount);
      budgetDisplay.textContent = `Budget: ‚Ç±${budget.toFixed(2)}`;
      expenseList.innerHTML = "";
      expenses.forEach(exp => {
        const li = document.createElement("li");
        li.textContent = `${exp.date} - ${exp.name} - ‚Ç±${exp.amount.toFixed(2)} (${exp.category})`;
        li.className = "p-2 bg-gray-50 rounded-lg shadow-sm";
        expenseList.appendChild(li);
      });
      expenseChart.data.datasets[0].data = Object.values(categories);
      expenseChart.update();
      updateSummary();
    }

    budgetForm.addEventListener("submit", function(e) {
      e.preventDefault();
      budget = parseFloat(document.getElementById("budget-amount").value);
      budgetDisplay.textContent = `Budget: ‚Ç±${budget.toFixed(2)}`;
      saveUserData();
      updateSummary();
      budgetForm.reset();
    });

    expenseForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const name = document.getElementById("expense-name").value;
      const amount = parseFloat(document.getElementById("expense-amount").value);
      const date = document.getElementById("expense-date").value;
      const category = document.getElementById("expense-category").value;
      expenses.push({ name, amount, category, date });
      categories[category] += amount;
      const li = document.createElement("li");
      li.textContent = `${date} - ${name} - ‚Ç±${amount.toFixed(2)} (${category})`;
      li.className = "p-2 bg-gray-50 rounded-lg shadow-sm";
      expenseList.appendChild(li);
      expenseChart.data.datasets[0].data = Object.values(categories);
      expenseChart.update();
      saveUserData();
      updateSummary();
      expenseForm.reset();
      document.getElementById("expense-date").valueAsDate = new Date();
    });

    function updateSummary() {
      const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
      totalExpensesDisplay.textContent = `Total Expenses: ‚Ç±${totalExpenses.toFixed(2)}`;
      const remaining = budget - totalExpenses;
      remainingBudgetDisplay.textContent = `Remaining Budget: ‚Ç±${remaining.toFixed(2)}`;
      remainingBudgetDisplay.className = remaining < 0 ? "text-red-500 font-bold" : "text-green-600 font-bold";
      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();
      const monthlyExpenses = expenses.filter(exp => { const d = new Date(exp.date); return d.getMonth() === currentMonth && d.getFullYear() === currentYear; }).reduce((sum, exp) => sum + exp.amount, 0);
      monthlyTotalDisplay.textContent = `Monthly Expenses: ‚Ç±${monthlyExpenses.toFixed(2)}`;
      const annualExpenses = expenses.filter(exp => new Date(exp.date).getFullYear() === currentYear).reduce((sum, exp) => sum + exp.amount, 0);
      annualTotalDisplay.textContent = `Annual Expenses: ‚Ç±${annualExpenses.toFixed(2)}`;
      let monthlyData = Array(12).fill(0);
      expenses.forEach(exp => { const d = new Date(exp.date); if (d.getFullYear() === currentYear) { monthlyData[d.getMonth()] += exp.amount; } });
      monthlyChart.data.datasets[0].data = monthlyData;
      monthlyChart.update();
    }

    function saveUserData() {
      const user = JSON.parse(localStorage.getItem("user_" + currentUser));
      localStorage.setItem("user_" + currentUser, JSON.stringify({ password: user.password, budget, expenses }));
    }

    // ====== Reset Button ======
    document.getElementById("reset-btn").addEventListener("click", () => {
      if (confirm("‚ö†Ô∏è Are you sure you want to reset all budget and expenses?")) {
        budget = 0;
        expenses = [];
        categories = { Food: 0, Transport: 0, Bills: 0, Shopping: 0, Other: 0 };
        saveUserData();
        expenseList.innerHTML = "";
        expenseChart.data.datasets[0].data = Object.values(categories);
        expenseChart.update();
        monthlyChart.data.datasets[0].data = Array(12).fill(0);
        monthlyChart.update();
        budgetDisplay.textContent = "Budget: ‚Ç±0.00";
        updateSummary();
      }
    });
  </script>
</body>
</html>
