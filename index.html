<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense & Budget Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: url('https://img.freepik.com/free-photo/flat-lay-calculator-desk_23-2148516518.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    .overlay {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 1rem;
    }
    header {
      position: relative;
    }
    #logout-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
  </style>
</head>
<body class="font-sans">

  <!-- Header -->
  <header class="text-white text-3xl font-bold text-center p-6 bg-gray-800 bg-opacity-80">
    Expense & Budget Tracker
    <button id="logout-btn" class="hidden bg-red-500 px-4 py-2 rounded-lg">Log Out</button>
  </header>

  <!-- Auth Section -->
  <div id="auth-section" class="overlay w-full max-w-md mx-auto mt-10">
    <h2 id="auth-title" class="text-xl font-semibold mb-4">Log In</h2>
    
    <!-- Log In -->
    <form id="login-form" class="space-y-2">
      <input type="text" id="login-username" placeholder="Enter username" required class="w-full p-2 border rounded-lg">
      <input type="password" id="login-password" placeholder="Enter password" required class="w-full p-2 border rounded-lg">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg w-full hover:bg-blue-600">Log In</button>
      <p class="text-sm text-center mt-2">Don’t have an account? 
        <a href="#" id="switch-to-signup" class="text-blue-600 hover:underline">Sign Up</a>
      </p>
    </form>
    
    <!-- Sign Up (hidden by default) -->
    <form id="register-form" class="space-y-2 hidden">
      <input type="text" id="reg-username" placeholder="Choose a username" required class="w-full p-2 border rounded-lg">
      <input type="password" id="reg-password" placeholder="Choose a password" required class="w-full p-2 border rounded-lg">
      <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded-lg w-full hover:bg-green-600">Sign Up</button>
      <p class="text-sm text-center mt-2">Already have an account? 
        <a href="#" id="switch-to-login" class="text-blue-600 hover:underline">Log In</a>
      </p>
    </form>
    
    <p id="auth-message" class="mt-2 text-red-500 text-sm"></p>
  </div>

  <!-- Dashboard -->
  <main id="dashboard" class="hidden p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Budget -->
    <div class="overlay">
      <h2 class="text-xl font-semibold mb-4">Set Budget</h2>
      <input type="number" id="budget-input" placeholder="Enter budget" class="w-full p-2 border rounded-lg">
      <button id="set-budget" class="bg-green-500 text-white px-4 py-2 rounded-lg mt-2 w-full hover:bg-green-600">Set Budget</button>
      <p id="budget-display" class="mt-2 text-lg font-semibold">Budget: ₱0.00</p>
    </div>

    <!-- Summary -->
    <div class="overlay">
      <h2 class="text-xl font-semibold mb-4">Summary</h2>
      <p id="total-expenses" class="text-lg">Total Expenses: ₱0.00</p>
      <p id="remaining-budget" class="text-lg font-semibold">Remaining Budget: ₱0.00</p>
      <hr class="my-2">
      <p id="monthly-total" class="text-md">Monthly Expenses: ₱0.00</p>
      <p id="annual-total" class="text-md">Annual Expenses: ₱0.00</p>
      <button id="reset-btn" class="mt-4 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 w-full">
        Reset Tracker
      </button>
    </div>

    <!-- Add Expense -->
    <div class="overlay">
      <h2 class="text-xl font-semibold mb-4">Add Expense</h2>
      <input type="text" id="expense-name" placeholder="Expense name" class="w-full p-2 border rounded-lg mb-2">
      <input type="number" id="expense-amount" placeholder="Amount" class="w-full p-2 border rounded-lg mb-2">
      <input type="date" id="expense-date" class="w-full p-2 border rounded-lg mb-2">
      <select id="expense-category" class="w-full p-2 border rounded-lg mb-2">
        <option>Food</option>
        <option>Transport</option>
        <option>Bills</option>
        <option>Shopping</option>
        <option>Other</option>
      </select>
      <button id="add-expense" class="bg-blue-500 text-white px-4 py-2 rounded-lg w-full hover:bg-blue-600">Add Expense</button>
    </div>

    <!-- Expenses List -->
    <div class="overlay">
      <h2 class="text-xl font-semibold mb-4">Expenses</h2>
      <ul id="expense-list" class="space-y-2 text-sm"></ul>
    </div>

    <!-- Pie Chart -->
    <div class="overlay shadow-md">
      <h2 class="text-xl font-semibold mb-4">Category Breakdown</h2>
      <canvas id="expenseChart"></canvas>
    </div>

    <!-- Bar Chart -->
    <div class="overlay shadow-md">
      <h2 class="text-xl font-semibold mb-4">Monthly Expenses (This Year)</h2>
      <canvas id="monthlyChart"></canvas>
    </div>
  </main>

  <script>
    // ===== User Storage =====
    let users = JSON.parse(localStorage.getItem("users")) || {};
    let currentUser = null;
    let budget = 0;
    let expenses = [];
    let categories = { Food: 0, Transport: 0, Bills: 0, Shopping: 0, Other: 0 };

    const authSection = document.getElementById("auth-section");
    const dashboard = document.getElementById("dashboard");
    const logoutBtn = document.getElementById("logout-btn");
    const authMessage = document.getElementById("auth-message");

    // Switch between Log In and Sign Up
    document.getElementById("switch-to-signup").addEventListener("click", (e) => {
      e.preventDefault();
      document.getElementById("login-form").classList.add("hidden");
      document.getElementById("register-form").classList.remove("hidden");
      document.getElementById("auth-title").textContent = "Sign Up";
    });

    document.getElementById("switch-to-login").addEventListener("click", (e) => {
      e.preventDefault();
      document.getElementById("register-form").classList.add("hidden");
      document.getElementById("login-form").classList.remove("hidden");
      document.getElementById("auth-title").textContent = "Log In";
    });

    // Register
    document.getElementById("register-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const username = document.getElementById("reg-username").value.trim();
      const password = document.getElementById("reg-password").value.trim();
      if (users[username]) {
        authMessage.textContent = "⚠️ Username already exists!";
      } else {
        users[username] = { password, budget: 0, expenses: [] };
        localStorage.setItem("users", JSON.stringify(users));
        authMessage.textContent = "✅ Account created! Please log in.";
        document.getElementById("register-form").reset();
      }
    });

    // Log In
    document.getElementById("login-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const username = document.getElementById("login-username").value.trim();
      const password = document.getElementById("login-password").value.trim();
      if (users[username] && users[username].password === password) {
        currentUser = username;
        budget = users[username].budget || 0;
        expenses = users[username].expenses || [];
        categories = { Food: 0, Transport: 0, Bills: 0, Shopping: 0, Other: 0 };
        expenses.forEach(exp => categories[exp.category] += exp.amount);

        authSection.classList.add("hidden");
        dashboard.classList.remove("hidden");
        logoutBtn.classList.remove("hidden");
        updateSummary();
        renderExpenses();
        expenseChart.update();
        monthlyChart.update();
      } else {
        authMessage.textContent = "❌ Invalid username or password!";
      }
    });

    // Log Out
    logoutBtn.addEventListener("click", () => {
      currentUser = null;
      dashboard.classList.add("hidden");
      authSection.classList.remove("hidden");
      logoutBtn.classList.add("hidden");
    });

    // ===== Tracker =====
    const budgetInput = document.getElementById("budget-input");
    const budgetDisplay = document.getElementById("budget-display");
    const totalExpensesDisplay = document.getElementById("total-expenses");
    const remainingBudgetDisplay = document.getElementById("remaining-budget");
    const monthlyTotalDisplay = document.getElementById("monthly-total");
    const annualTotalDisplay = document.getElementById("annual-total");
    const expenseName = document.getElementById("expense-name");
    const expenseAmount = document.getElementById("expense-amount");
    const expenseDate = document.getElementById("expense-date");
    const expenseCategory = document.getElementById("expense-category");
    const expenseList = document.getElementById("expense-list");

    document.getElementById("set-budget").addEventListener("click", () => {
      budget = parseFloat(budgetInput.value) || 0;
      saveUserData();
      budgetDisplay.textContent = `Budget: ₱${budget.toFixed(2)}`;
      updateSummary();
    });

    document.getElementById("add-expense").addEventListener("click", () => {
      const name = expenseName.value.trim();
      const amount = parseFloat(expenseAmount.value);
      const date = expenseDate.value;
      const category = expenseCategory.value;
      if (name && amount && date) {
        const exp = { name, amount, date, category };
        expenses.push(exp);
        categories[category] += amount;
        saveUserData();
        renderExpenses();
        updateSummary();
        expenseChart.update();
        monthlyChart.update();
        expenseName.value = "";
        expenseAmount.value = "";
      }
    });

    // Reset Button
    document.getElementById("reset-btn").addEventListener("click", () => {
      if (confirm("⚠️ Reset all data?")) {
        budget = 0;
        expenses = [];
        categories = { Food: 0, Transport: 0, Bills: 0, Shopping: 0, Other: 0 };
        saveUserData();
        expenseList.innerHTML = "";
        expenseChart.data.datasets[0].data = Object.values(categories);
        expenseChart.update();
        monthlyChart.data.datasets[0].data = Array(12).fill(0);
        monthlyChart.update();
        budgetDisplay.textContent = "Budget: ₱0.00";
        updateSummary();
      }
    });

    // ===== Charts =====
    const ctx = document.getElementById("expenseChart").getContext("2d");
    const expenseChart = new Chart(ctx, {
      type: "pie",
      data: {
        labels: Object.keys(categories),
        datasets: [{
          data: Object.values(categories),
          backgroundColor: ["#f87171", "#60a5fa", "#facc15", "#34d399", "#a78bfa"]
        }]
      }
    });

    const monthlyCtx = document.getElementById("monthlyChart").getContext("2d");
    const monthlyChart = new Chart(monthlyCtx, {
      type: "bar",
      data: {
        labels: ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
        datasets: [{
          label: "Monthly Expenses (₱)",
          data: Array(12).fill(0),
          backgroundColor: "#60a5fa"
        }]
      },
      options: { scales: { y: { beginAtZero: true } } }
    });

    // ===== Functions =====
    function updateSummary() {
      const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
      totalExpensesDisplay.textContent = `Total Expenses: ₱${totalExpenses.toFixed(2)}`;
      const remaining = budget - totalExpenses;
      remainingBudgetDisplay.textContent = `Remaining Budget: ₱${remaining.toFixed(2)}`;
      remainingBudgetDisplay.className = remaining < 0 ? "text-red-500 font-bold" : "text-green-600 font-bold";

      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();

      const monthlyExpenses = expenses.filter(exp => new Date(exp.date).getMonth() === currentMonth && new Date(exp.date).getFullYear() === currentYear)
        .reduce((sum, exp) => sum + exp.amount, 0);
      monthlyTotalDisplay.textContent = `Monthly Expenses: ₱${monthlyExpenses.toFixed(2)}`;

      const annualExpenses = expenses.filter(exp => new Date(exp.date).getFullYear() === currentYear)
        .reduce((sum, exp) => sum + exp.amount, 0);
      annualTotalDisplay.textContent = `Annual Expenses: ₱${annualExpenses.toFixed(2)}`;

      let monthlyData = Array(12).fill(0);
      expenses.forEach(exp => {
        const d = new Date(exp.date);
        if (d.getFullYear() === currentYear) {
          monthlyData[d.getMonth()] += exp.amount;
        }
      });
      monthlyChart.data.datasets[0].data = monthlyData;
      monthlyChart.update();
    }

    function renderExpenses() {
      expenseList.innerHTML = "";
      expenses.forEach(exp => {
        const li = document.createElement("li");
        li.textContent = `${exp.date} - ${exp.name} (₱${exp.amount.toFixed(2)}) [${exp.category}]`;
        expenseList.appendChild(li);
      });
    }

    function saveUserData() {
      if (currentUser) {
        users[currentUser].budget = budget;
        users[currentUser].expenses = expenses;
        localStorage.setItem("users", JSON.stringify(users));
      }
    }
  </script>
</body>
</html>
