<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense & Budget Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      min-height: 100vh;
      font-family: Inter, sans-serif;
      background: linear-gradient(rgba(255,255,255,0.9), rgba(255,255,255,0.9)),
        url("https://img.freepik.com/free-vector/hand-drawn-accounting-pattern_23-2149153588.jpg") center/cover fixed no-repeat;
    }
    .card {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      padding: 1.5rem;
    }
  </style>
</head>
<body class="p-6">

  <!-- Auth Section -->
  <div id="authSection" class="max-w-md mx-auto card">
    <h2 id="authTitle" class="text-2xl font-bold mb-4 text-center">Login</h2>
    <form id="authForm" class="space-y-4">
      <input id="username" type="text" placeholder="Username" class="w-full border rounded p-2" required>
      <input id="password" type="password" placeholder="Password" class="w-full border rounded p-2" required>
      <button id="authBtn" type="submit" class="w-full bg-blue-600 text-white p-2 rounded">Login</button>
    </form>
    <p class="text-center mt-4">
      <span id="toggleAuth" class="text-blue-600 cursor-pointer">Don't have an account? Sign up</span>
    </p>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold">Expense & Budget Tracker</h1>
      <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded">Logout</button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Budget -->
      <div class="card">
        <h2 class="text-xl font-semibold mb-2">Set Budget</h2>
        <input id="budgetInput" type="number" placeholder="Enter budget" class="border p-2 rounded w-full mb-2">
        <button id="setBudgetBtn" class="bg-green-500 text-white px-4 py-2 rounded">Set Budget</button>
        <button id="resetBtn" class="bg-gray-400 text-white px-4 py-2 rounded ml-2">Reset</button>
      </div>

      <!-- Add Expense -->
      <div class="card">
        <h2 class="text-xl font-semibold mb-2">Add Expense</h2>
        <input id="expenseName" type="text" placeholder="Expense name" class="border p-2 rounded w-full mb-2">
        <input id="expenseAmount" type="number" placeholder="Amount" class="border p-2 rounded w-full mb-2">
        <input id="expenseDate" type="date" class="border p-2 rounded w-full mb-2">
        <select id="expenseCategory" class="border p-2 rounded w-full mb-2">
          <option>Food</option>
          <option>Transport</option>
          <option>Bills</option>
          <option>Shopping</option>
          <option>Other</option>
        </select>
        <button id="addExpenseBtn" class="bg-blue-500 text-white px-4 py-2 rounded">Add Expense</button>
      </div>

      <!-- Expenses List -->
      <div class="card col-span-1 md:col-span-2">
        <h2 class="text-xl font-semibold mb-2">Expenses</h2>
        <ul id="expenseList" class="space-y-2"></ul>
      </div>

      <!-- Summary -->
      <div class="card">
        <h2 class="text-xl font-semibold mb-2">Summary</h2>
        <p id="totalExpenses">Total Expenses: ₱0</p>
        <p id="remainingBudget">Remaining Budget: ₱0</p>
        <p id="monthlyExpenses">Monthly Expenses: ₱0</p>
        <p id="annualExpenses">Annual Expenses: ₱0</p>
      </div>

      <!-- Chart -->
      <div class="card">
        <h2 class="text-xl font-semibold mb-2">Expenses Breakdown</h2>
        <canvas id="expenseChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    // === Auth ===
    const authSection = document.getElementById("authSection");
    const dashboard = document.getElementById("dashboard");
    const authForm = document.getElementById("authForm");
    const authTitle = document.getElementById("authTitle");
    const authBtn = document.getElementById("authBtn");
    const toggleAuth = document.getElementById("toggleAuth");
    const logoutBtn = document.getElementById("logoutBtn");

    let isLogin = true;
    let users = JSON.parse(localStorage.getItem("users")) || {};
    let currentUser = null;

    toggleAuth.addEventListener("click", () => {
      isLogin = !isLogin;
      authTitle.textContent = isLogin ? "Login" : "Sign Up";
      authBtn.textContent = isLogin ? "Login" : "Sign Up";
      toggleAuth.textContent = isLogin
        ? "Don't have an account? Sign up"
        : "Already have an account? Login";
    });

    authForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value;

      if (isLogin) {
        if (users[username] && users[username].password === password) {
          currentUser = username;
          showDashboard();
        } else {
          alert("Invalid login");
        }
      } else {
        if (users[username]) {
          alert("User already exists");
        } else {
          users[username] = { password, budget: 0, expenses: [], categories: {} };
          localStorage.setItem("users", JSON.stringify(users));
          alert("Account created! Please log in.");
          isLogin = true;
          authTitle.textContent = "Login";
          authBtn.textContent = "Login";
          toggleAuth.textContent = "Don't have an account? Sign up";
        }
      }
    });

    logoutBtn.addEventListener("click", () => {
      currentUser = null;
      dashboard.classList.add("hidden");
      authSection.classList.remove("hidden");
    });

    // === Tracker ===
    const budgetInput = document.getElementById("budgetInput");
    const setBudgetBtn = document.getElementById("setBudgetBtn");
    const resetBtn = document.getElementById("resetBtn");
    const expenseName = document.getElementById("expenseName");
    const expenseAmount = document.getElementById("expenseAmount");
    const expenseDate = document.getElementById("expenseDate");
    const expenseCategory = document.getElementById("expenseCategory");
    const addExpenseBtn = document.getElementById("addExpenseBtn");
    const expenseList = document.getElementById("expenseList");
    const totalExpenses = document.getElementById("totalExpenses");
    const remainingBudget = document.getElementById("remainingBudget");
    const monthlyExpenses = document.getElementById("monthlyExpenses");
    const annualExpenses = document.getElementById("annualExpenses");

    let budget = 0;
    let expenses = [];
    let categories = {};
    let chart;

    function saveUserData() {
      users[currentUser].budget = budget;
      users[currentUser].expenses = expenses;
      users[currentUser].categories = categories;
      localStorage.setItem("users", JSON.stringify(users));
    }

    function showDashboard() {
      authSection.classList.add("hidden");
      dashboard.classList.remove("hidden");

      budget = users[currentUser].budget || 0;
      expenses = users[currentUser].expenses || [];
      categories = users[currentUser].categories || {};
      renderExpenses();
      updateSummary();
    }

    setBudgetBtn.addEventListener("click", () => {
      budget = parseFloat(budgetInput.value) || 0;
      saveUserData();
      updateSummary();
    });

    resetBtn.addEventListener("click", () => {
      budget = 0;
      expenses = [];
      categories = {};
      saveUserData();
      renderExpenses();
      updateSummary();
    });

    addExpenseBtn.addEventListener("click", () => {
      const name = expenseName.value.trim();
      const amount = parseFloat(expenseAmount.value);
      const date = expenseDate.value || new Date().toISOString().split("T")[0];
      const category = expenseCategory.value;

      if (!name || isNaN(amount) || amount <= 0) {
        alert("Please enter valid details");
        return;
      }

      const expense = { name, amount, date, category };
      expenses.push(expense);
      categories[category] = (categories[category] || 0) + amount;

      saveUserData();
      renderExpenses();
      updateSummary();

      expenseName.value = "";
      expenseAmount.value = "";
      expenseDate.value = "";
    });

    function renderExpenses() {
      expenseList.innerHTML = "";
      expenses.forEach((e, index) => {
        let li = document.createElement("li");
        li.classList.add("flex","justify-between","items-center","bg-gray-100","p-2","rounded");

        li.innerHTML = `
          <span>${e.name} - ₱${e.amount.toFixed(2)} (${e.category})</span>
          <div>
            <button class="edit-btn bg-yellow-400 text-white px-2 py-1 rounded mr-2">Edit</button>
            <button class="delete-btn bg-red-500 text-white px-2 py-1 rounded">Delete</button>
          </div>
        `;

        li.querySelector(".delete-btn").addEventListener("click", () => {
          expenses.splice(index, 1);
          categories[e.category] -= e.amount;
          saveUserData();
          renderExpenses();
          updateSummary();
        });

        li.querySelector(".edit-btn").addEventListener("click", () => {
          let newName = prompt("Edit expense name:", e.name) || e.name;
          let newAmount = parseFloat(prompt("Edit amount:", e.amount)) || e.amount;
          let newCategory = prompt("Edit category:", e.category) || e.category;

          categories[e.category] -= e.amount;
          e.name = newName;
          e.amount = newAmount;
          e.category = newCategory;
          categories[newCategory] = (categories[newCategory] || 0) + newAmount;

          saveUserData();
          renderExpenses();
          updateSummary();
        });

        expenseList.appendChild(li);
      });
    }

    function updateSummary() {
      let total = expenses.reduce((acc, e) => acc + e.amount, 0);
      totalExpenses.textContent = `Total Expenses: ₱${total.toFixed(2)}`;
      remainingBudget.textContent = `Remaining Budget: ₱${(budget - total).toFixed(2)}`;

      let now = new Date();
      let month = now.getMonth();
      let year = now.getFullYear();
      let monthlyTotal = expenses.filter(e => new Date(e.date).getMonth() === month && new Date(e.date).getFullYear() === year)
                                 .reduce((acc, e) => acc + e.amount, 0);
      let annualTotal = expenses.filter(e => new Date(e.date).getFullYear() === year)
                                .reduce((acc, e) => acc + e.amount, 0);

      monthlyExpenses.textContent = `Monthly Expenses: ₱${monthlyTotal.toFixed(2)}`;
      annualExpenses.textContent = `Annual Expenses: ₱${annualTotal.toFixed(2)}`;

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById("expenseChart"), {
        type: "pie",
        data: {
          labels: Object.keys(categories),
          datasets: [{
            data: Object.values(categories),
            backgroundColor: ["#f87171","#60a5fa","#34d399","#fbbf24","#a78bfa"]
          }]
        }
      });
    }

    // === Enter key shortcuts ===
    [expenseName, expenseAmount, expenseDate, expenseCategory].forEach(el => {
      el.addEventListener("keypress", e => {
        if (e.key === "Enter") {
          e.preventDefault();
          addExpenseBtn.click();
        }
      });
    });

    budgetInput.addEventListener("keypress", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        setBudgetBtn.click();
      }
    });

    // === Enter key for Login/Signup ===
    authForm.addEventListener("keypress", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        authBtn.click();
      }
    });
  </script>
</body>
</html>
